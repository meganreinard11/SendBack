// Expense.swift
import Foundation
import CoreData

@objc(Expense)
public class Expense: NSManagedObject { }

extension Expense {
    @nonobjc public class func fetchRequest() -> NSFetchRequest<Expense> {
        NSFetchRequest<Expense>(entityName: "Expense")
    }

    // Base attributes (matches XML: abstract entity)
    @NSManaged public var amount: NSDecimalNumber?        // Decimal
    @NSManaged public var date: Date?                     // Date
    @NSManaged public var id: UUID                        // UUID (required)
    @NSManaged public var isReimbursable: Bool            // default NO
    @NSManaged public var mileage: Int32
    @NSManaged public var notes: String?

    // Base relationships
    @NSManaged public var car: Car?
    @NSManaged public var claim: InsuranceClaim?
    @NSManaged public var merchant: Merchant?
}

extension Expense: Identifiable { }

public extension Expense {
    var amountDecimal: Decimal { amount?.decimalValue ?? .zero }
    var amountDouble: Double { amount?.doubleValue ?? 0 }
    var amountFormatted: String {
        let f = NumberFormatter(); f.numberStyle = .currency; f.maximumFractionDigits = 2
        return f.string(from: amount ?? 0) ?? "$0.00"
    }
}
